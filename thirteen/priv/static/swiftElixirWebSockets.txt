[SECTION:DATA_MODELS]
-------------------------------------------------------------------------------------------
                            ðŸ—ï¸  FOUNDATIONAL DATA MODELS
-------------------------------------------------------------------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    USER ENTITY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User                                                                               â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ external_id (string) - from Swift app's user system                          â”‚
â”‚  â”œâ”€â”€ name (string, optional)                                                       â”‚
â”‚  â”œâ”€â”€ email (string, optional)                                                      â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚  â””â”€â”€ updated_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: has_many tasks                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 MODEL REGISTRY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Model                                                                              â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ name (string) - "SDXL", "Stable Video Diffusion", etc.                       â”‚
â”‚  â”œâ”€â”€ replicate_owner (string) - "stability-ai", "meta", etc.                      â”‚
â”‚  â”œâ”€â”€ replicate_name (string) - "sdxl", "llama-2-70b-chat", etc.                   â”‚
â”‚  â”œâ”€â”€ version_hash (string) - Replicate's version identifier                       â”‚
â”‚  â”œâ”€â”€ category (enum) - [:image, :video, :audio, :text, :code]                     â”‚
â”‚  â”œâ”€â”€ input_schema (map/json) - Defines expected parameters                        â”‚
â”‚  â”œâ”€â”€ is_active (boolean) - Can be used for new tasks                              â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚  â””â”€â”€ updated_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: has_many tasks                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                TASK ENTITY (Core)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Task                                                                               â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ user_id (binary_id, foreign key)                                              â”‚
â”‚  â”œâ”€â”€ model_id (binary_id, foreign key)                                             â”‚
â”‚  â”œâ”€â”€ status (enum) - [:queued, :processing, :completed, :failed, :cancelled]      â”‚
â”‚  â”œâ”€â”€ priority (integer) - For task queue ordering                                 â”‚
â”‚  â”œâ”€â”€ input_data (map/json) - All input parameters for the model                   â”‚
â”‚  â”œâ”€â”€ progress (float) - 0.0 to 1.0                                                â”‚
â”‚  â”œâ”€â”€ estimated_duration_seconds (integer, nullable)                               â”‚
â”‚  â”œâ”€â”€ started_at (utc_datetime, nullable)                                           â”‚
â”‚  â”œâ”€â”€ completed_at (utc_datetime, nullable)                                         â”‚
â”‚  â”œâ”€â”€ error_message (text, nullable)                                                â”‚
â”‚  â”œâ”€â”€ error_code (string, nullable)                                                 â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚  â””â”€â”€ updated_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: belongs_to user, belongs_to model, has_one replicate_prediction,  â”‚
â”‚                 has_many outputs                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           REPLICATE PREDICTION ENTITY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ReplicatePrediction                                                                â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ task_id (binary_id, foreign key, unique)                                      â”‚
â”‚  â”œâ”€â”€ prediction_id (string) - Replicate's prediction UUID                         â”‚
â”‚  â”œâ”€â”€ status (string) - Raw status from Replicate API                              â”‚
â”‚  â”œâ”€â”€ webhook_received_at (utc_datetime, nullable)                                  â”‚
â”‚  â”œâ”€â”€ logs (text, nullable) - Replicate's logs                                      â”‚
â”‚  â”œâ”€â”€ metrics (map/json, nullable) - Performance metrics                           â”‚
â”‚  â”œâ”€â”€ replicate_created_at (utc_datetime)                                           â”‚
â”‚  â”œâ”€â”€ replicate_completed_at (utc_datetime, nullable)                               â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚  â””â”€â”€ updated_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: belongs_to task                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              OUTPUT ENTITY                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Output                                                                             â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ task_id (binary_id, foreign key)                                              â”‚
â”‚  â”œâ”€â”€ type (enum) - [:image, :video, :audio, :text, :file]                         â”‚
â”‚  â”œâ”€â”€ format (string) - "png", "mp4", "wav", "txt", etc.                           â”‚
â”‚  â”œâ”€â”€ cloud_url (string) - Final storage URL                                        â”‚
â”‚  â”œâ”€â”€ temporary_url (string, nullable) - Replicate's temporary URL                  â”‚
â”‚  â”œâ”€â”€ file_size_bytes (integer, nullable)                                           â”‚
â”‚  â”œâ”€â”€ duration_seconds (float, nullable) - For video/audio                         â”‚
â”‚  â”œâ”€â”€ dimensions (map, nullable) - {width: 1024, height: 1024}                     â”‚
â”‚  â”œâ”€â”€ metadata (map/json, nullable) - Additional properties                        â”‚
â”‚  â”œâ”€â”€ uploaded_at (utc_datetime, nullable)                                          â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚  â””â”€â”€ updated_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: belongs_to task                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WEBHOOK EVENT ENTITY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebhookEvent                                                                       â”‚
â”‚  â”œâ”€â”€ id (binary_id, primary key)                                                   â”‚
â”‚  â”œâ”€â”€ task_id (binary_id, foreign key, nullable)                                    â”‚
â”‚  â”œâ”€â”€ replicate_prediction_id (string)                                              â”‚
â”‚  â”œâ”€â”€ event_type (string) - "start", "output", "completed", "failed"               â”‚
â”‚  â”œâ”€â”€ payload (map/json) - Full webhook payload                                     â”‚
â”‚  â”œâ”€â”€ processed (boolean) - Whether we've acted on this event                      â”‚
â”‚  â”œâ”€â”€ processed_at (utc_datetime, nullable)                                         â”‚
â”‚  â”œâ”€â”€ created_at (utc_datetime)                                                     â”‚
â”‚                                                                                     â”‚
â”‚  Relationships: belongs_to task (optional)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[SECTION:ARCHITECTURE_DIAGRAM]
-------------------------------------------------------------------------------------------
                           ðŸ”„ REAL-TIME WEBSOCKET ARCHITECTURE
-------------------------------------------------------------------------------------------


        Client-Side (Swift App)                  Server-Side (Phoenix on Fly.io)
    +--------------------------------+       +------------------------------------------------+
    |                                |       |       Synchronous API Flow (Instantaneous)     |
    |                                |       |                                                |
    | 1. POST /api/tasks             |------>| Phoenix Controller                             |
    |    {prompt: "...",             |       |   - Create `Task` {status: :queued}            |
    |     user_id: "user_123"}       |       |   - Enqueue Oban Job                           |
    |                                |       |                                                |
    |                                |<------| 2. HTTP 202 Accepted {task_id: "..."}          |
    |                                |       |                                                |
    | 3. Connect to WebSocket        |       |                                                |
    |    wss://.../socket            |------>| Phoenix Channel (`UserSocket`)                 |
    |                                |       |   - Authenticate (hardcoded user)              |
    | 4. Join Channel                |       |                                                |
    |    "task:<task_id>"            |------>|   - Authorize join                             |
    |                                |       |                                                |
    +--------------------------------+       +------------------------------------------------+
             ^                               |       Asynchronous Background Flow (Slow)      |
             |                               |                                                |
             |                               |   +------------------+   +-------------------+ |
             |                               |   |   Oban Worker    |   |  PostgreSQL DB    | |
             |                               |   |------------------|   |-------------------| |
             |                               |   | 5. Pick up Job   |<--| (Job is waiting)  | |
             |                               |   |------------------|   +-------------------+ |
             |                               |   | 6. Update Task   |-->| status: :processing | |
             |                               |   |    {progress: 10}|   | progress: 10      | |
             |                               |   +--------+---------+   +-------------------+ |
             |                               |            |                                   |
             |                               |            | 7. Broadcast Update via PubSub    |
             |                               |            |                                   |
             |                               |   +--------v---------+                         |
             +-------------------------------|---| Phoenix Channel  |                         |
             | 8. PUSH "progress_update"     |   | (receives bcast) |                         |
             |    {progress: 10, ...}        |   +------------------+                         |
             |                               |            |                                   |
             |                               |            | ** Replicate Integration **       |
             |                               |            |                                   |
             |                               |   +--------v---------+   +-------------------+ |
             |                               |   |   Oban Worker    |   |  Replicate API    | |
             |                               |   |------------------|   |-------------------| |
             |                               |   | 8a. Call Replicate |-->| 8b. Run ML Model  | |
             |                               |   |     API with     |   |                   | |
             |                               |   |     `prompt`     |<--| (Returns result   | |
             |                               |   |------------------|   |   or webhook)     | |
             |                               |   +--------+---------+   +-------------------+ |
             |                               |            |                                   |
             |                               |            | 9. Upload result |-->[Google Cloud Storage]|
             |                               |            |    to Cloud      |                         |
             |                               |   +--------v---------+   +-------------------+ |
             |                               |   |   Oban Worker    |   | status: :completed  | |
             |                               |   |------------------|   | Create `Output`     | |
             |                               |   | 10. Update Task  |-->| {content_url: ...}| |
             |                               |   |     & create     |   +-------------------+ |
             |                               |   |     `Output`     |                         |
             |                               |   +--------+---------+                         |
             |                               |            |                                   |
             |                               |            | 11. Broadcast "task_completed"    |
             |                               |            |                                   |
             |                               |   +--------v---------+                         |
             +-------------------------------|---| Phoenix Channel  |                         |
               12. PUSH "task_completed"     |   +------------------+                         |
                   {content_url: "..."}      |                                                |
                                             +------------------------------------------------+